# 実装タスク - 漫画データベース情報システム

## 実装概要

この文書は、漫画データベース情報システムの9週間実装計画を示します。承認された技術設計書に基づき、6つのコアモデル（MangaSeries、Episode、Magazine、MagazineIssue、TankobonVolume、AffiliateLink）を使用したNext.js + tRPC + PostgreSQL + Prismaスタックでの開発を行います。

## 実装スケジュール

### Phase 1: 基盤構築 (Week 1-2)

#### Week 1: プロジェクトセットアップ

- [ ] **1.1 Next.js プロジェクト初期化**
  - Next.js 14 + TypeScript + Tailwind CSSプロジェクト作成
  - App Routerの設定とディレクトリ構造の構築
  - 基本的なESLint/Prettierルールの設定
  - パッケージ依存関係の初期設定（tRPC, Prisma, Zod等）

- [ ] **1.2 開発環境の構築**
  - Docker Compose設定ファイルの作成（PostgreSQL含む）
  - 環境変数設定ファイル（.env）の準備
  - 開発用データベースコンテナの起動確認
  - VS Code設定ファイルとデバッグ設定

- [ ] **1.3 Prismaセットアップ**
  - Prisma Client初期化
  - PostgreSQLデータベース接続設定
  - 基本的なPrismaスキーマファイル作成
  - データベースマイグレーション機能テスト

#### Week 2: データベーススキーマ実装

- [ ] **2.1 基本データモデル実装**
  - MangaSeriesモデルの定義（シリーズレベル）
  - Mangaモデルの定義（個別作品レベル、JSON配列での作者・ジャンル管理）
  - Episodeモデルの定義（mangaIdとの関係性含む）
  - MangaStatusエニューの定義
  - 2階層リレーション設定（Series → Manga → Episode/TankobonVolume）

- [ ] **2.2 出版関連モデル実装**
  - Magazineモデルの定義（雑誌情報管理）
  - MagazineIssueモデルの定義（雑誌号管理）
  - TankobonVolumeモデルの定義（mangaIdとの関係性で単行本巻管理）
  - 出版関連のリレーション設定（Episode → Magazine/TankobonVolume、TankobonVolume → Manga）

- [ ] **2.3 アフィリエイトモデル実装**
  - AffiliateLinkモデルの定義
  - 単行本とアフィリエイトリンクの関係性設定
  - クリック追跡用フィールドの追加
  - 初回データベースマイグレーション実行

- [ ] **2.4 データベース最適化**
  - 基本インデックスの設定（シリーズタイトル、作品タイトル、日付、関連ID）
  - JSON配列検索用GINインデックスの設定（Mangaテーブルの作者・ジャンル）
  - ユニーク制約の設定（mangaId + volumeNumber等）
  - 外部キー制約の設定（seriesId、mangaId参照整合性）

### Phase 2: コア機能実装 (Week 3-5)

#### Week 3: tRPC基盤とAPI実装

- [ ] **3.1 tRPC Router基盤構築**
  - tRPC設定とMiddleware実装
  - 基本的なcontextの設定（Prismaクライアント含む）
  - エラーハンドリングシステムの構築
  - Zodバリデーションスキーマの基本設定

- [ ] **3.2 漫画シリーズAPI実装**
  - manga-series routerの作成
  - シリーズ検索API実装（シリーズタイトル検索）
  - シリーズ詳細取得API実装（所属作品一覧含む）
  - ページネーション機能実装
  - ソート機能実装（タイトル）

- [ ] **3.3 漫画作品API実装**
  - manga routerの作成
  - 作品検索API実装（タイトル、作者、ジャンル検索）
  - 作品詳細取得API実装
  - シリーズ別作品一覧API実装
  - ページネーション機能実装
  - ソート機能実装（タイトル、開始日）

- [ ] **3.4 エピソードAPI実装**
  - episode routerの作成
  - エピソード一覧取得API実装
  - エピソード詳細取得API実装
  - 作品別エピソード取得API実装（mangaId）
  - シリーズ別エピソード取得API実装（seriesIdで全作品のエピソード）
  - エピソード番号による並び替え機能

#### Week 4: 雑誌・単行本API実装

- [ ] **4.1 雑誌API実装**
  - magazine routerの作成
  - 雑誌一覧取得API実装
  - 雑誌詳細取得API実装（発行号一覧含む）
  - 出版社によるフィルタリング機能
  - 雑誌号詳細取得API実装

- [ ] **4.2 単行本API実装**
  - tankobon routerの作成
  - 単行本詳細取得API実装（収録エピソード情報含む）
  - 作品別単行本一覧取得API実装（mangaId）
  - シリーズ別単行本一覧取得API実装（seriesIdで全作品の単行本）
  - ISBN検索機能実装
  - 巻数による並び替え機能

- [ ] **4.3 アフィリエイトAPI実装**
  - affiliate routerの作成
  - アフィリエイトリンク取得API実装
  - クリック追跡API実装（リダイレクト機能含む）
  - プラットフォーム別リンク管理
  - 統計情報取得API実装

#### Week 5: 基本CRUD操作実装

- [ ] **5.1 漫画シリーズ管理機能**
  - シリーズ作成API実装
  - シリーズ更新API実装
  - シリーズ削除API実装（カスケード削除含む）
  - シリーズ内作品管理機能

- [ ] **5.2 漫画作品管理機能**
  - 作品作成API実装（seriesIdとの関連付け）
  - 作品更新API実装
  - 作品削除API実装（カスケード削除含む）
  - JSON配列での作者・ジャンル管理機能
  - ステータス更新機能

- [ ] **5.3 エピソード管理機能**
  - エピソード作成API実装（mangaIdとの関連付け）
  - エピソード更新API実装
  - エピソード削除API実装
  - 雑誌号・単行本巻との関連付け機能
  - 話数の自動採番機能

- [ ] **5.4 出版情報管理機能**
  - 雑誌作成・更新・削除API実装
  - 雑誌号作成・更新・削除API実装
  - 単行本作成・更新・削除API実装（mangaIdとの関連付け）
  - アフィリエイトリンク作成・更新・削除API実装
  - バリデーション機能強化

### Phase 3: フロントエンド実装 (Week 6-7)

#### Week 6: 基本UIコンポーネント実装

- [ ] **6.1 共通UIコンポーネント作成**
  - Button, Input, Card, SearchBarコンポーネント実装
  - Tailwind CSSを使用したレスポンシブデザイン
  - Loading状態とError状態の表示コンポーネント
  - ページネーションコンポーネント実装
  - モーダル・ダイアログコンポーネント実装

- [ ] **6.2 レイアウトコンポーネント実装**
  - ヘッダーコンポーネント実装（ナビゲーション含む）
  - サイドバーコンポーネント実装
  - フッターコンポーネント実装
  - レスポンシブレイアウトの構築
  - ダークモード対応の基盤実装

- [ ] **6.3 検索機能UI実装**
  - 高度検索フォームコンポーネント実装
  - 検索結果表示コンポーネント実装
  - フィルタリングUIコンポーネント実装
  - 検索履歴機能実装
  - 検索状態管理の実装

#### Week 7: 詳細ページとリスト表示実装

- [ ] **7.1 漫画シリーズ表示コンポーネント**
  - SeriesCardコンポーネント実装（シリーズグリッド表示用）
  - SeriesGridコンポーネント実装（シリーズ一覧表示）
  - SeriesDetailコンポーネント実装（シリーズ詳細ページ、所属作品一覧含む）
  - シリーズ情報表示機能

- [ ] **7.2 漫画作品表示コンポーネント**
  - MangaCardコンポーネント実装（作品グリッド表示用）
  - MangaGridコンポーネント実装（作品一覧表示）
  - MangaDetailコンポーネント実装（作品詳細ページ）
  - 作者・ジャンル表示機能
  - ステータス表示機能

- [ ] **7.3 エピソード表示コンポーネント**
  - EpisodeListコンポーネント実装
  - EpisodeCardコンポーネント実装
  - エピソード詳細表示コンポーネント実装
  - 掲載情報・収録情報表示機能
  - 話数ナビゲーション機能

- [ ] **7.4 雑誌・単行本表示コンポーネント**
  - MagazineCardコンポーネント実装
  - IssueListコンポーネント実装（雑誌号一覧）
  - VolumeCardコンポーネント実装
  - VolumeGridコンポーネント実装
  - 出版日・発売日表示機能

### Phase 4: アフィリエイト統合とページ実装 (Week 8)

#### Week 8: ページ実装とアフィリエイト機能

- [ ] **8.1 メインページ実装**
  - ホームページ実装（検索機能中心）
  - 漫画シリーズ詳細ページ実装（/series/[id]）
  - 漫画作品詳細ページ実装（/manga/[id]）
  - エピソード詳細ページ実装（/episodes/[id]）
  - 雑誌一覧・詳細ページ実装（/magazines）
  - 単行本詳細ページ実装（/tankobon/[id]）

- [ ] **8.2 アフィリエイト機能実装**
  - AffiliateLinksコンポーネント実装
  - クリック追跡機能の統合
  - プラットフォーム別リンク表示
  - アフィリエイトリンクの管理UI実装
  - リダイレクト機能の実装

- [ ] **8.3 管理機能実装**
  - 管理ダッシュボードページ実装（/admin）
  - 基本認証システムの統合
  - シリーズ管理ページ実装（/admin/series）
  - 漫画作品管理ページ実装（/admin/manga）
  - データの一括インポート・エクスポート機能
  - 統計情報表示機能

- [ ] **8.4 検索・フィルタリング機能統合**
  - フロントエンドとAPIの統合
  - シリーズ・作品別検索機能実装
  - リアルタイム検索機能実装
  - 検索結果のページネーション実装
  - 高度検索機能の統合（作者、ジャンル、ステータス）
  - 検索結果の並び替え機能

### Phase 5: 最適化と運用準備 (Week 9)

#### Week 9: パフォーマンス最適化と運用準備

- [ ] **9.1 パフォーマンス最適化**
  - Next.js App Routerキャッシング設定
  - データベースクエリ最適化
  - 画像最適化設定
  - バンドルサイズ最適化
  - Core Web Vitals改善

- [ ] **9.2 監視・ログシステム実装**
  - 基本ログシステム実装
  - エラーログ収集機能実装
  - ヘルスチェックAPI実装（/api/health）
  - パフォーマンス監視設定
  - アクセス統計機能実装

- [ ] **9.3 セキュリティ強化**
  - 入力値検証の強化
  - SQLインジェクション対策確認
  - CSRF対策実装
  - レート制限機能実装
  - セキュリティヘッダー設定

- [ ] **9.4 本番環境デプロイ準備**
  - Vercelデプロイ設定
  - 本番データベース設定（Neon/Supabase）
  - 環境変数の本番設定
  - ドメイン設定
  - SSL証明書設定

- [ ] **9.5 テスト・品質保証**
  - 単体テストの実装（主要API）
  - 統合テストの実装（検索機能）
  - E2Eテストの実装（主要ユーザーフロー）
  - パフォーマンステスト実行
  - セキュリティテスト実行

## 技術要件詳細

### 開発環境要件
- Node.js 18以上
- PostgreSQL 15以上
- Docker & Docker Compose
- Next.js 14 + TypeScript
- Tailwind CSS

### データベース要件
- PostgreSQL（JSON型サポート）
- GINインデックス（JSON検索用）
- 基本的なACID準拠
- 約10,000シリーズ規模対応

### パフォーマンス要件
- ページロード時間: 3秒以内
- 検索応答時間: 1秒以内
- 同時接続数: 100ユーザー対応
- データベース応答時間: 500ms以内

### セキュリティ要件
- 管理機能の基本認証
- 入力値検証（Zod使用）
- SQLインジェクション対策
- XSS対策（React標準対策）

## リスク対応

### 高リスク項目
1. **JSON配列検索のパフォーマンス**: GINインデックス最適化で対応
2. **アフィリエイトリンク管理の複雑さ**: 手動管理に限定して簡素化
3. **大量データでの検索速度**: ページネーション強制で対応

### 中リスク項目
1. **データベース設計の変更**: マイグレーション戦略で対応
2. **UI/UXの改善要求**: 段階的改善でスコープ管理
3. **外部API統合**: Phase 1では除外、将来機能として残す

## 成果物チェックリスト

### コード成果物
- [ ] Next.js + TypeScript アプリケーション
- [ ] Prisma データベーススキーマとマイグレーション
- [ ] tRPC API ルーター（5つのルーター）
- [ ] React コンポーネント（20以上）
- [ ] Tailwind CSS スタイリング

### ドキュメント成果物
- [ ] API ドキュメント（tRPC自動生成）
- [ ] データベース設計書
- [ ] デプロイメント手順書
- [ ] 運用マニュアル
- [ ] 開発環境セットアップガイド

### テスト成果物
- [ ] 単体テスト（80%以上のカバレッジ）
- [ ] 統合テスト（主要API）
- [ ] E2Eテスト（5つの主要フロー）
- [ ] パフォーマンステスト結果
- [ ] セキュリティテスト結果

## 完了基準

### 機能完了基準
- 漫画シリーズの検索・表示機能が動作する
- エピソード・雑誌・単行本の関係性が正しく表示される
- アフィリエイトリンクのクリック追跡が動作する
- 管理機能でデータの作成・更新・削除が可能
- レスポンシブデザインが各デバイスで動作する

### 品質完了基準
- すべてのテストがパスする
- パフォーマンス要件を満たす
- セキュリティ要件を満たす
- コードレビューが完了している
- ドキュメントが完成している

### 運用完了基準
- 本番環境での動作確認完了
- 監視・ログシステムが動作している
- バックアップ・復旧手順が確立されている
- 運用チームへの引き継ぎ完了
- 保守・更新手順が文書化されている

このタスクリストは、承認された技術設計書に基づいた実装可能な詳細タスクを提供します。各タスクは1-3日程度で完了可能な粒度に分割されており、9週間での完了を目標としています。